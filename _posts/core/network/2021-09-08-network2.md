---
title: 
date: 2021-09-08 07:36:57
categories: 'eBPF,Linux,内核,网络代码'
tags:
  - ebpf
author: Jony
---

# ne_device

```c
	enum { NETREG_UNINITIALIZED=0, // 数据结构已经分配，且内容已经请 0
	       NETREG_REGISTERED,	/* 设备已经完成注册 */
	       NETREG_UNREGISTERING,	/* called unregister_netdevice */
	       NETREG_UNREGISTERED,	/* 设备已经完全除名 */
	       NETREG_RELEASED,		/* 结构已经被释放 */
	       NETREG_DUMMY,		/* dummy device for NAPI poll */
	} reg_state:8;
```
设备状态

```c
int register_netdev(struct net_device *dev)
{
	int err;

	if (rtnl_lock_killable()) 
		return -EINTR;
	err = register_netdevice(dev);
	rtnl_unlock();
	return err;
}
```

加锁为了 `Routing Netlink` 信号量的保护。

