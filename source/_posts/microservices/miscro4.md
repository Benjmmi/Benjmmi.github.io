---
title: Other - 服务治理架构价值-为什么要服务治理
date: 2021-04-01 17:29:11
categories: 
	- [Other]
tags:
  - http
  - glang
author: Jony
---


# 背景

公司目前要建立服务治理体系架构，建立服务化的之前先问下为什么需要服务治理？
可以先想象一下，随着公司的业务发展需要建立的服务将会越来越多，服务之间的依赖，关系将会越来越复杂
在这种错综复杂的调用如果没有一个能掌握全局的架构人员，可能任何一点的改动都会牵一发而动全身。
所以服务治理首先要解决**复杂性**问题。将服务与服务之间的依赖清晰化、调理化组件之间的上下文边界。


# 架构演进过程

根据背景大致了解了公司目前服务治理要解决的主要问题，所以先从服务架构的演进过程推演服务治理的演进过程。
服务架构从历史到目前的主流的体系架构，大致分为以下几个过程：

### 单一应用架构

单一应用架构也是企业初期最长采用的架构，网站流量较小、所需功能较少只需要一个应用，将所有的功能部署
在一起基本可以支持用户的访问量

### 垂直应用架构

当访问量增大、功能需求增多单一应用架构已经不能够支撑当前的访问量，这个时候会将功能不相干的业务独立
拆分出来建立多个系统提供应用。比如：MVC 模式前后端分离

### 分布式服务架构

当垂直应用、功能进一步扩大，应用和应用之间必定就会出现依赖关系，从业务架构体系上就会将共享的功能
抽离出来，细分为单独的服务对外提供访问。拆分出来独立服务经过时间的积累就会逐渐形成独立的稳定的服
务中心。服务与服务之间的拆分、服务整合就会形成 **分布式服务框架（RPC）**

### 流动计算架构

当服务越来越多，关于容量的评估：小服务资源的浪费、大服务资源的不足等一系列问题慢慢的就会凸显出来
这个时候就需要统一的调度中心，基于访问压力实时管理资源容量，提高资源利用率。为了提供资源利用率的
关键就会引入 **服务治理(SOA)**

# 服务治理过程

通过架构的演进过程，可以大致的了解到公司目前的架构处于哪个阶段。下面我们了解下整个服务治理的演进
过程和存在的必要性。
在大规模接入服务治理之前，应用与应用之间的依赖关系，只能通过简单的端口暴露和URL地址访问的形式进
行调用。通过一些 Nginx 或者 Iptables 是等组件负载均衡器接入 

### 1. 当服务越来越多，URL 也会随着变的庞大 ，管理起来非常困难，负载均衡的压力将会越来越大

此时就需要注册中心、动态的注册和发现服务，让服务实例的位置更加透明。消费方通过一定的手段获取到服
务方的实例列表，实现软负载均衡的方式，降低对负载均衡器的依赖，也可以降低一些运维成本并且提高一些
性能

### 2. 再推进一步，服务之间与服务之间的依赖越来越多，依赖关系变的错综复杂。可能架构师都已经不
###    能 Hold 住全局

这个时候，应该自动构出应用的之间依赖关系图帮助开发人员、运维人员、架构师等理解应用之间的依赖关系

### 3. 随着应用的调用量越来越大，服务的容量问题就暴露出来。比如双十一的流量突增需要
###    评估需要多少机器？什么时间段扩缩容？

为了准确的预估容量就需要获取每天的调用量、相应时间、资源利用率等数据都需要准确的统计出来，作为
扩缩容衡量的一个参考。

### 4. 随着应用数量扩大，沟通成本也会随着上升，调用某个功能是否有实现、服务的参数应该怎么定义、
###    某个服务失败应该找谁等一系列问题

对于上面这种情况就需要将每个服务提供的功能、参数定义、负责人建立档案以检索的方式提供给开发人员

### 5. 随着时间的推移，很多服务已经过了最热的生命周期，只有丁点的流量，但是却需要两台提供服务的
###    实例，如何减少资源的浪费


总上所述了应该也是目前我们可能会多多少少遇到的问题，所以我们需要通过服务治理架构方式来解决上
述遇到的问题。解决上述问题的时候就需要搭建一些基础设施和制定一些共同遵守的标准协议，来协助整个
服务治理的落地。

## 标准化的制定

- 服务的定义：提供方如何暴露一个服务，调用方应该如何去调用一个服务
- 服务的调用：服务的调用通常是远程，以何种方式调用？阻塞、非阻塞？
- 服务的通信协议：服务方与调用方如何标准化通信协议？二进制、JSON文本？
- 服务的版本化：服务肯定需要升级，升级的话是否需要版本化？是否需要向下兼容？
- 服务的安全：服务调用时需要加密？还是裸奔？

## 基础设施的落地

- 注册中心：注册中心可以为调用方提供服务提供方，实时监控到服务提供的状态，使集群保持活性
- 服务监控：通过埋点、定时上报等。监控服务的调用频率、调用时间、可用性等
- 服务自动化测试：服务的变更、升级等都会应用到依赖方，需要一套完整的自动化流程框架
- 服务归属：当服务存在多依赖方，谁来维护这个服务，职责如何划分

# 基础设施落地

## 注册中心



nacos方案和 istio se路线（技术难度、当前异构适配程度、实施难度和工作量、核心业务支持的速度、
性能、拓展性、架构合理性、治理难度、未来趋势）

昨天我们讨论的内容和大方向，要落实到几个子任务，估计时间，有明确的预期（思路更新到Confluence上）了我们和梁田、晓腾同步一下；

为互联互通，
1、java怎么做；已经做了什么
2、php怎么做？
3、go怎么做？
4、k8s和k8s controller怎么做？
5、dot内如何支持，研发改动什么，运维变更什么？


nacos不是目的，只是一个途径（我们不会明确给青岛要求，你们来介入nacos吧）； 
而是， 我们要带着明确的目的（让devops实现具体的功能）来起草标准规范，然后准备前置的方案，
业务方用了这些方案，就能获得功能；已知的几个方向：比如：pod ip直通，还是可以方便的熔断，限流，监测+验活，调用链？









