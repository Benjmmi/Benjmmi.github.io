---
title: Kubernetes - 网络专题 - CNI
date: 2021-10-18 16:42:00
categories: 
	- [gRPC]
tags:
  - microservices
  - Kubernetes
  - k8s
author: Jony
---


# CNI




CNI Container Network Interface 的缩写。就是标准的、通用接口。应用于 Kubernetes、docker、
contained。还有其他网络解决方案。

CNI 的主要工作是从容器管理系统处获取运行信息。包括 network namespace的路径、容器 ID 和 network interface name。再从容器网络的配置文件中加载网络配置信息，再将这些信息传递给对应的插件。由插件进行具体的网络配置工作。

上面的描述总结来说 CNI 用于管理网络插口类似于网管的工作。但是不会介入通信管理。不支持通信。抽象来说像给容器安装网络插口、插上网线、分配IP。

CNI 主要职责：

1. 分配网络插口

分配网络插口需要存储到仓库中，仓库唯一键需要包含：network_name、CNI_CONTAINERID、CNI_IFNAME 三元组信息
network namespace 必须要在容器中创建

2. 管理 IP 地址分配。IPAM

ADD 操作必须在 DEL 之后，如果没有 DEL　操作，那么如果遇到　三元组冲突应当返回错误信息，不进行分配
DEL　操作应当存在幂等性。


# `CNI` 工作模式

`CNI` 接口并不是 `HTTP`、`gRPC` 接口，`CNI` 接口是指对可执行文件的调用。（所以在宿主机上查找 
`CNI` 进程可能查找不到）这些可执行程序称之为CNI插件，以`k8s`为例，`s8s`节点默认的`CNI`插件路径为
 `/opt/cni/bin`






