I"1<h1 id="cni">CNI</h1>

<p>CNI Container Network Interface 的缩写。就是标准的、通用接口。应用于 Kubernetes、docker、
contained。还有其他网络解决方案。</p>

<p>CNI 的主要工作是从容器管理系统处获取运行信息。包括 network namespace的路径、容器 ID 和 network interface name。再从容器网络的配置文件中加载网络配置信息，再将这些信息传递给对应的插件。由插件进行具体的网络配置工作。</p>

<p>上面的描述总结来说 CNI 用于管理网络插口类似于网管的工作。但是不会介入通信管理。不支持通信。抽象来说像给容器安装网络插口、插上网线、分配IP。</p>

<p>CNI 主要职责：</p>

<ol>
  <li>分配网络插口</li>
</ol>

<p>分配网络插口需要存储到仓库中，仓库唯一键需要包含：network_name、CNI_CONTAINERID、CNI_IFNAME 三元组信息
network namespace 必须要在容器中创建</p>

<ol>
  <li>管理 IP 地址分配。IPAM</li>
</ol>

<p>ADD 操作必须在 DEL 之后，如果没有 DEL　操作，那么如果遇到　三元组冲突应当返回错误信息，不进行分配
DEL　操作应当存在幂等性。</p>

<h1 id="cni-工作模式"><code class="language-plaintext highlighter-rouge">CNI</code> 工作模式</h1>

<p><code class="language-plaintext highlighter-rouge">CNI</code> 接口并不是 <code class="language-plaintext highlighter-rouge">HTTP</code>、<code class="language-plaintext highlighter-rouge">gRPC</code> 接口，<code class="language-plaintext highlighter-rouge">CNI</code> 接口是指对可执行文件的调用。（所以在宿主机上查找 
<code class="language-plaintext highlighter-rouge">CNI</code> 进程可能查找不到）这些可执行程序称之为CNI插件，以<code class="language-plaintext highlighter-rouge">k8s</code>为例，<code class="language-plaintext highlighter-rouge">s8s</code>节点默认的<code class="language-plaintext highlighter-rouge">CNI</code>插件路径为
 <code class="language-plaintext highlighter-rouge">/opt/cni/bin</code></p>

:ET