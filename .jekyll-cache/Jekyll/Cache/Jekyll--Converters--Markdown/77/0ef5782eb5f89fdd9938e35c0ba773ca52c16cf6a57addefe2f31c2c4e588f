I"’<h1 id="cilium-æºç é˜…è¯»-åŠŸèƒ½è§£æ">Cilium æºç é˜…è¯»ï¼š åŠŸèƒ½è§£æ</h1>

<p>æŸ¥çœ‹äº†ä¸€ä¸‹ cilium-docker çš„åŠŸèƒ½ä¸»è¦ä»¥ IPAM ä¸ºä¸»
sudo nohup /home/vagrant/go/bin/dlv attach 651 â€“headless=true â€“listen=:9526  â€“api-version=2 â€“accept-multiclient â€“log &amp;
sudo nohup /home/vagrant/go/bin/dlv attach 18376 â€“headless=true â€“listen=:9527  â€“api-version=2 â€“accept-multiclient â€“log &amp;
sudo nohup /home/vagrant/go/bin/dlv attach 5049 â€“headless=true â€“listen=:9528  â€“api-version=2 â€“accept-multiclient â€“log &amp;</p>

<p>docker network create â€“driver cilium â€“ipam-driver cilium cilium-net
docker run -d â€“name app1 â€“net cilium-net -l â€œid=app1â€ cilium/demo-httpd
docker run â€“rm -ti â€“net cilium-net -l â€œid=app2â€ cilium/demo-client curl -m 20 http://app1</p>

<p>export HTTP_PROXY=http://192.168.0.90:58591; export HTTPS_PROXY=http://192.168.0.90:58591; export ALL_PROXY=socks5://192.168.0.90:51837</p>

<p>http:///var/run/cilium/cilium.sock//v1/ipam?family=ipv4&amp;owner=docker-ipam
Accept:application/json
Content-Type:application/json
Expiration:false</p>

<p>curl -X POST â€“unix-socket /var/run/cilium/cilium.sock <br />
  â€˜http:///v1/ipam?family=ipv4&amp;owner=docker-ipamâ€™ <br />
  -H â€˜Accept: application/jsonâ€™ <br />
  -H â€˜Content-Type: application/jsonâ€™ <br />
  -H â€˜Expiration: falseâ€™</p>

<p>curl -XPOST â€“unix-socket /var/run/cilium/cilium.sock/  http://localhost/v1/ipam?family=ipv4&amp;owner=docker-ipam</p>

<p>HTTP/1.1 201 Created
Content-Type: application/json
Date: Sun, 13 Jun 2021 08:41:33 GMT
Content-Length: 259</p>

<p>{â€œaddressâ€:{â€œipv4â€:â€10.11.215.121â€},â€host-addressingâ€:{â€œipv4â€:{â€œalloc-rangeâ€:â€10.11.0.0/16â€,â€enabledâ€:true,â€ipâ€:â€10.11.168.111â€},â€ipv6â€:{â€œalloc-rangeâ€:â€f00d::a0f:0:0:0/96â€,â€enabledâ€:true,â€ipâ€:â€f00d::a0f:0:0:56a9â€}},â€ipv4â€:{â€œcidrsâ€:null,â€ipâ€:â€10.11.215.121â€}}
elâ€:â€Noneâ€,â€NAT46â€:â€Disabledâ€,â€PolicyAuditModeâ€:â€Disabledâ€,â€PolicyVerdictNotificationâ€:â€Enabledâ€,â€TraceNotificationâ€:â€Enabledâ€}},â€statusâ€:{â€œcontrollersâ€:[{â€œconfigurationâ€:{â€œerror-retryâ€:true,â€error-retry-baseâ€:â€2sâ€},â€nameâ€:â€endpoint-922-regeneration-recoveryâ€,â€statusâ€:{â€œlast-failure-timestampâ€:â€0001-01-01T00:00:00.000Zâ€,â€last-success-timestampâ€:â€0001-01-01T00:00:00.000Zâ€},â€uuidâ€:â€00b7c499-cc22-11eb-8a22-080027e4875dâ€},{â€œconfigurationâ€:{â€œerror-retryâ€:true,â€intervalâ€:â€5m0sâ€},â€nameâ€:â€resolve-identity-922â€,â€statusâ€:{â€œlast-failure-timestampâ€:â€0001-01-01T00:00:00.000Zâ€,â€last-success-timestampâ€:â€2021-06-13T08:33:17.807Zâ€,â€success-countâ€:1},â€uuidâ€:â€00b9ae9e-cc22-11eb-8a22-080027e4875dâ€},{â€œconfigurationâ€:{â€œerror-retryâ€:true,â€intervalâ€:â€5m0sâ€},â€nameâ€:â€sync-IPv4-identity-mapping (922)â€,â€statusâ€:{â€œlast-failure-timestampâ€:â€0001-01-01T00:00:00.000Zâ€,â€last-success-timestampâ€:â€2021-06-13T08:33:17.806Zâ€,â€success-countâ€:1},â€uuidâ€:â€00b939f9-cc22-11eb-8a22-080027e4875dâ€},{â€œconfigurationâ€:{â€œerror-retryâ€:true,â€intervalâ€:â€1m0sâ€},â€nameâ€:â€sync-policymap-922â€,â€statusâ€:{â€œlast-failure-timestampâ€:â€0001-01-01T00:00:00.000Zâ€,â€last-success-timestampâ€:â€2021-06-13T08:33:18.387Zâ€,â€success-countâ€:1},â€uuidâ€:â€011253cb-cc22-11eb-8a22-080027e4875dâ€}],â€external-identifiersâ€:{â€œdocker-endpoint-idâ€:â€74515cf5064ba31007dabcf724e6fa3d2914241f01da8ba888227ab3a0283304â€,â€docker-network-idâ€:â€f1e88970d55e632a6f130bcacb4a9e328a3489d88c231b191fcff94e053d30edâ€,â€pod-nameâ€:â€/â€},â€healthâ€:{â€œbpfâ€:â€OKâ€,â€connectedâ€:true,â€overallHealthâ€:â€OKâ€,â€policyâ€:â€OKâ€},â€identityâ€:{â€œidâ€:5,â€labelsâ€:[â€œreserved:initâ€],â€labelsSHA256â€:â€200a5c3596eeb6d318ecd6d810acfd1fd5408e498501fd8a7ed212d3adab62e3â€},â€labelsâ€:{â€œrealizedâ€:{},â€security-relevantâ€:[â€œreserved:initâ€]},â€logâ€:[{â€œcodeâ€:â€OKâ€,â€messageâ€:â€Successfully regenerated endpoint program (Reason: updated security labels)â€,â€stateâ€:â€readyâ€,â€timestampâ€:â€2021-06-13T08:33:18Zâ€}],â€networkingâ€:{â€œaddressingâ€:[{â€œipv4â€:â€10.11.125.251â€}],â€host-macâ€:â€3a:e1:e1:cb:18:23â€,â€interface-indexâ€:19,â€interface-nameâ€:â€lxcc502f5f6cac7â€,â€macâ€:â€92:59:a2:63:f0:9câ€},â€policyâ€:{â€œproxy-statisticsâ€:[],â€realizedâ€:{â€œallowed-egress-identitiesâ€:[],â€allowed-ingress-identitiesâ€:[],â€buildâ€:1,â€cidr-policyâ€:{â€œegressâ€:[],â€ingressâ€:[]},â€idâ€:5,â€l4â€:{â€œegressâ€:[],â€ingressâ€:[]},â€policy-enabledâ€:â€bothâ€,â€policy-revisionâ€:1},â€specâ€:{â€œallowed-egress-identitiesâ€:[],â€allowed-ingress-identitiesâ€:[],â€buildâ€:1,â€cidr-policyâ€:{â€œegressâ€:[],â€ingressâ€:[]},â€idâ€:5,â€l4â€:{â€œegressâ€:[],â€ingressâ€:[]},â€policy-enabledâ€:â€bothâ€,â€policy-revisionâ€:1}},â€realizedâ€:{â€œlabel-configurationâ€:{},â€optionsâ€:{â€œConntrackâ€:â€Enabledâ€,â€ConntrackAccountingâ€:â€Enabledâ€,â€ConntrackLocalâ€:â€Disabledâ€,â€Debugâ€:â€Disabledâ€,â€DebugLBâ€:â€Disabledâ€,â€DebugPolicyâ€:â€Disabledâ€,â€DropNotificationâ€:â€Enabledâ€,â€MonitorAggregationLevelâ€:â€Noneâ€,â€NAT46â€:â€Disabledâ€,â€PolicyAuditModeâ€:â€Disabledâ€,â€PolicyVerdictNotificationâ€:â€Enabledâ€,â€TraceNotificationâ€:â€Enabledâ€}},â€stateâ€:â€readyâ€}}</p>
:ET