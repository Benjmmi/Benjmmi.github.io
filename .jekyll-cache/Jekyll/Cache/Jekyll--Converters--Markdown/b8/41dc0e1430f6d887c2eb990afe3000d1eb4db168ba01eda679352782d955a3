I""	<h1 id="ne_device">ne_device</h1>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="k">enum</span> <span class="p">{</span> <span class="n">NETREG_UNINITIALIZED</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1">// 数据结构已经分配，且内容已经请 0</span>
	       <span class="n">NETREG_REGISTERED</span><span class="p">,</span>	<span class="cm">/* 设备已经完成注册 */</span>
	       <span class="n">NETREG_UNREGISTERING</span><span class="p">,</span>	<span class="cm">/* called unregister_netdevice */</span>
	       <span class="n">NETREG_UNREGISTERED</span><span class="p">,</span>	<span class="cm">/* 设备已经完全除名 */</span>
	       <span class="n">NETREG_RELEASED</span><span class="p">,</span>		<span class="cm">/* 结构已经被释放 */</span>
	       <span class="n">NETREG_DUMMY</span><span class="p">,</span>		<span class="cm">/* dummy device for NAPI poll */</span>
	<span class="p">}</span> <span class="n">reg_state</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
</code></pre></div></div>
<p>设备状态</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">register_netdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtnl_lock_killable</span><span class="p">())</span> 
		<span class="k">return</span> <span class="o">-</span><span class="n">EINTR</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">register_netdevice</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">rtnl_unlock</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>加锁为了 <code class="language-plaintext highlighter-rouge">Routing Netlink</code> 信号量的保护。</p>

:ET