# 编写驱动程序的步骤


剩余需要的操作
并发
队列
中断
驱动网络硬件
内存操作
MMAP

# MMAP 原理

mmap 映射是将用户空间的一段内存与设备内存关联起来。无论何时当程序在分配地址范围
内读写时，实际上访问的就是设备内存。以提高性能，但是安全性相对降低。

mmap 的缺点就是必须以 `PAGE_SIZE`(一般 4096) 为单位进行映射。内核只能在页表一级上
对虚拟地址进行管理，因此那些被映射的区域必须是`PAGE_SIZE` 的整数倍，并且在物理内存
中的其实地址也要求是 `PAGE_SIZE` 的整数倍。

如果不是整数倍，那么内将会强制指定比区域稍大点的尺寸作为映射的粒度。

通常 vma 包含了用于访问设备的虚拟地址的信息。其中虚拟地址转为设备地址的大量工作由
内核完成。mmap 的操作与 vma 不同，mmap 需要为映射的设备地址重新建立页表，并且使用
`vma->vm_ops` 替代原先的操作




